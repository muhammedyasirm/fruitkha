<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lumiere Mobiles</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="css/linearicons.css" />
    <link rel="stylesheet" href="css/font-awesome.min.css" />
    <link rel="stylesheet" href="css/themify-icons.css" />
    <link rel="stylesheet" href="css/bootstrap.css" />
    <link rel="stylesheet" href="css/owl.carousel.css" />
    <link rel="stylesheet" href="css/nice-select.css" />
    <link rel="stylesheet" href="css/nouislider.min.css" />
    <link rel="stylesheet" href="css/ion.rangeSlider.css" />
    <link rel="stylesheet" href="css/ion.rangeSlider.skinFlat.css" />
    <link rel="stylesheet" href="css/magnific-popup.css" />
    <link rel="stylesheet" href="css/main.css" />
    <link rel="stylesheet" href="/profile.css">
    

    <link rel="stylesheet" href="/style.css" />
  </head>
  <body style="height: 100vh;">
    <header class="header_area sticky-header">
      <div class="main_menu">
        <nav class="navbar navbar-expand-lg navbar-light main_box">
          <div class="container">
            <!-- Brand and toggle get grouped for better mobile display -->
            <a class="navbar-brand logo_h" href="/"
              >
              <!-- <img src="img/logo.png" alt=""
            /> -->
            <h2 style="font-family: serif;font-weight: 700;">Lumiere Mobiles</h2>
          </a>
            <button
              class="navbar-toggler"
              type="button"
              data-toggle="collapse"
              data-target="#navbarSupportedContent"
              aria-controls="navbarSupportedContent"
              aria-expanded="false"
              aria-label="Toggle navigation"
            >
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <!-- Collect the nav links, forms, and other content for toggling -->
            <div
              class="collapse navbar-collapse offset"
              id="navbarSupportedContent"
            >
              <ul
                class="nav navbar-nav  menu_nav ml-auto d-flex flex-row align-items-center justify-content-end"
              >
                <li class="nav-item">
                  <a class="nav-link" href="/">Home</a>
                </li>
                <li class="nav-item submenu dropdown">
                  <a
                    href="/mobile"
                    class="nav-link "
                  
                    >Mobiles</a
                  >
                  
                </li>
                
                <li class="nav-item submenu dropdown">
                  <a
                    href="#"
                    class="nav-link dropdown-toggle"
                    data-toggle="dropdown"
                    role="button"
                    aria-haspopup="true"
                    aria-expanded="false"
                    ><span class="ti-user"></span
                  ></a>
                  <ul class="dropdown-menu">
                    <% if(email == null){ %> 
                    <li class="nav-item">
                      <a class="nav-link" href="/login">Login</a>
                    </li>
                    <% }else{ %> 
                    <li class="nav-item">
                      <a class="nav-link" href="/profile">Profile</a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link" href="/logout">Logout</a>
                    </li>
                    <% } %> 
                  </ul>
                </li>
                <li >
                  <a href="/wishList" class="heart"> <span class="ti-heart"></span></a>
                 
                </li>
                
              </ul>
              <ul class="nav navbar-nav navbar-right">
                <li class="nav-item"></li>
                <li class="nav-item">
                  <a href="/cart" class="cart"><span class="ti-bag"></span></a>
                </li>

                <!-- <li class="nav-item">
                  <button class="search">
                    <span class="lnr lnr-magnifier" id="search"></span>
                  </button>
                </li> -->
              </ul>
            </div>
          </div>
        </nav>
      </div>
      <!-- <div class="search_input" id="search_input_box">
        <div class="container">
          <form class="d-flex justify-content-between">
            <input
              type="text"
              class="form-control"
              id="search_input"
              placeholder="Search Here"
            />
            <button type="submit" class="btn"></button>
            <span
              class="lnr lnr-cross"
              id="close_search"
              title="Close Search"
            ></span>
          </form>
        </div>
      </div> -->
    </header>

   

    <%- body %>

    
    <footer class="footer-area section_gap" style="margin-top: 45px;">
      <div class="container">
        <div class="row">
          <div class="col-lg-4 col-md-6 col-sm-6">
            <div class="single-footer-widget">
              <h6>About Us</h6>
              <p>
                This website help you to buy brand new smart phones as you wish
              </p>
            </div>
          </div>
          <div class="col-lg-4 col-md-6 col-sm-6">
            <div class="single-footer-widget">
              <h6>Quick links</h6>
              <ul>
                <li><a href="/">Home</a></li>
                <li><a href="/mobile">Mobiles</a></li>
                <li><a href="/cart">Cart</a></li>
                <li><a href="/Wishlist">Wishlist</a></li>
            </ul>
              
            </div>
          </div>
          
          <div class="col-lg-4 col-md-6 col-sm-6">
            <div class="single-footer-widget">
              <h6>Follow Us</h6>
              <p>Let us be social</p>
              <div class="footer-social d-flex align-items-center">
                <a href="#"><i class="fa fa-facebook"></i></a>
                <a href="#"><i class="fa fa-twitter"></i></a>
                <a href="#"><i class="fa fa-instagram" aria-hidden="true"></i></a>
                <a href="#"><i class="fa fa-linkedin" aria-hidden="true"></i></a>
              </div>
            </div>
          </div>
        </div>
        <div
          class="footer-bottom d-flex justify-content-center align-items-center flex-wrap"
        >
          <p class="footer-text m-0">
            <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
            Copyright &copy;
            <script>
              document.write(new Date().getFullYear());
            </script>
            All rights reserved

            <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
          </p>
        </div>
      </div>
    </footer>

    <script src="/index.js"></script>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"
      integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.min.js"
      integrity="sha384-IDwe1+LCz02ROU9k972gdyvl+AESN10+x7tBKgc9I5HFtuNz0wWnPclzo6p9vxnk"
      crossorigin="anonymous"
    ></script>
    <script src="js/vendor/jquery-2.2.4.min.js"></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js"
      integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4"
      crossorigin="anonymous"
    ></script>
    <script src="js/vendor/bootstrap.min.js"></script>
    <script src="js/jquery.ajaxchimp.min.js"></script>
    <script src="js/jquery.nice-select.min.js"></script>
    <script src="js/jquery.sticky.js"></script>
    <script src="js/nouislider.min.js"></script>
    <script src="js/countdown.js"></script>
    <script src="js/jquery.magnific-popup.min.js"></script>
    <script src="js/owl.carousel.min.js"></script>
    <!--gmaps Js-->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCjCGmQ0Uq4exrzdcL6rvxywDDOvfAu6eE"></script>
   
    <script src="js/gmaps.min.js"></script>
    <script src="js/main.js"></script>
  </body>
</html>
<section class="banner-area organic-breadcrumb">
    <div class="container">
      <div
        class="breadcrumb-banner d-flex flex-wrap align-items-center justify-content-end"
      >
        <div class="col-first">
          <h1>Shopping Cart</h1>
          <nav class="d-flex align-items-center">
            <a href="index.html">Home<span class="lnr lnr-arrow-right"></span></a>
            <a href="category.html">Cart</a>
          </nav>
        </div>
      </div>
    </div>
  </section>
  <!-- End Banner Area -->
  
  <!--================Cart Area =================-->
  <% if(cartDetails.length>0){ %> 
  <section class="cart_area">
    <div class="container">
      <div class="cart_inner">
        <div class="table-responsive">
          <table class="table">
            <thead>
              <tr>
                <th scope="col">Product</th>
                <th scope="col">Price</th>
                <th scope="col">Quantity</th>
                <th scope="col">Total</th>
              </tr>
            </thead>
            <tbody>
              <% for( product of cartDetails){ %> 
                <% for(products of product.products){ %> 
              <tr id="<%= product.cart_item.productId %>">
                <td>
                  <div class="media">
                    <div class="d-flex">
                      <a href="/product?id=<%= products._id %>">
                        <div style="background-image: url(<%=products.image[0].url%>);width: 100px;height: 150px;
                        background-size: contain;background-repeat: no-repeat;"></div>
                    </a>
                    </div>
                    <div class="media-body">
                      <p><%= products.product_name %> </p>
                    </div>
                  </div>
                </td>
                <td>
                  <h5><%= products.finalPrice %></h5>
                </td>
                <td>
                  <div class="product_count">
                    <input
                      type="number"
                      name="qty"
                      id="sst<%= products._id %>"
                      
                      value="<%= product.cart_item.product_quantity %>"
                      title="Quantity:"
                      class="input-text qty"
                      readonly
                    />
                    <button
                    
                      onclick="quantity('<%= products._id %>','<%= products.finalPrice %>','<%= product._id %>','1')"
                      class="increase items-count"
                      type="button"
                    >
                    
                      <i class="lnr lnr-chevron-up"></i>
                    </button>
                    <button
                      onclick="quantity('<%= products._id %>','<%= products.finalPrice %>','<%= product._id %>','-1')"
                      class="reduced items-count"
                      type="button"
                    >
                   
                      <i class="lnr lnr-chevron-down"></i>
                    </button>
                  </div>
                </td>
                <td>
                  <h5 id="total<%= products._id %>"><%= product.cart_item.product_quantity * products.finalPrice %></h5>
                </td>
                <td><a style="font-size: xx-large; cursor: pointer;" onclick="deleted('<%= product.cart_item.productId %>')">&times</a></td>
              </tr>
              <% }} %> 
              
              
              <tr>
                <td></td>
                <td></td>
                <td>
                  <h5>Subtotal</h5>
                </td>
                <td>
                  <h5 id="subtotal"><%= price %> </h5>
                </td>
              </tr>
              
              <tr class="out_button_area">
                <td></td>
                <td></td>
                <td></td>
                <td>
                  <div class="checkout_btn_inner d-flex align-items-center">
                    <a class="gray_btn" href="/">Continue Shopping</a>
                    <a class="primary-btn" href="/checkout">Proceed to checkout</a>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </section>
  <% }else{ %> 
    <section class="cart_area">
      <div class="container">
        <div class="cart_inner ">
          <div class="col-12 row">
          <div class="col-12 d-flex justify-content-center align-items-center">
            <img src="img/empty-cart.gif" alt="cart empty">
          </div>
          <div class="col-12 d-flex justify-content-center align-items-center">
            <h1 style="font-weight: 600;margin-top: 20px;">YOUR CART IS EMPTY</h1>
          </div>
          <div class="col-12 d-flex justify-content-center align-items-center">
            <a href="/mobile" class="primary-btn mt-3">Continue Shopping</a>
          </div>
        </div>
          </div>
          </div>
          </section>
    <% } %> 
  <!--================End Cart Area =================-->
  <script>
      
    function quantity(productId,price,cartId,count){
        let pid = String(productId)
        let countn = Number(count)
        const id = document.getElementById("sst"+pid)
        const totalId = document.getElementById("total"+pid)
        const subtotal = document.getElementById("subtotal");
        let qty =Number(id.value);
        let value = Number(subtotal.innerHTML);
        let pricee = Number(price)
        
      if(qty+countn>0){
        
        fetch("/quantityChange",{
            method:"post",
            headers:{ 'Content-Type': 'application/json'},
            body: JSON.stringify({ productId,cartId,count,qty }) 
        }).then(res =>res.json()).then(data=>{
            
            if(data.change == true){
              
              if(countn==1){
              
               ++qty
               total=price*qty
    
               totalId.innerHTML=total;
               subtotal.innerHTML= value+pricee
               
               id.value++
              }else if(countn == -1){
                
               --qty
               total=price*qty
               totalId.innerHTML=total;
               subtotal.innerHTML= value-pricee
                id.value--;
              }
               
               
            }
        })
      }
    }
  function deleted(productId) {
    let pid = String(productId)
    
          const id = document.getElementById(pid)
          let value = Number(subtotal.innerHTML);
          
          // console.log(document.getElementById("total"+pid).innerHTML);
          let pricee = Number(document.getElementById("total"+pid).innerHTML)
          
          
    fetch("/cartDelete",{
              method:"post",
              headers:{ 'Content-Type': 'application/json'},
              body: JSON.stringify({productId}) 
          }).then(res =>res.json()).then(data=>{
              
              if(data.deleted == true){
                value=value-pricee
                console.log(value);
                subtotal.innerHTML= value
                
                 id.remove()
              }
          })
  }
  </script>